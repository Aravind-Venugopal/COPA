define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","@ember/runloop","@ember/component","@ember/object/computed","rsvp","discourse/lib/ajax","discourse-common/utils/decorators"],function(e,t,s,r,n,i,a){"use strict";function c(t,r,e,s,n){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,s){return s(t,r,e)||e},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,r,i),i=null),i}var o,l,u,p,d,m,b;Object.defineProperty(e,"__esModule",{value:!0}),e.bufferTime=e.keepAliveDuration=void 0;var h=e.keepAliveDuration=1e4,f=e.bufferTime=3e3;e.default=s.default.extend((o=(0,a.on)("didInsertElement"),l=(0,a.observes)("action","post.id","topic.id"),u=(0,a.observes)("reply","title"),p=(0,a.on)("willDestroyElement"),d=(0,a.observes)("currentState"),m=(0,a.default)("presenceUsers","currentUser.id"),c(b={action:null,post:null,topic:null,reply:null,title:null,previousState:null,currentState:null,presenceUsers:null,channel:null,isReply:(0,r.equal)("action","reply"),shouldDisplay:(0,r.gt)("users.length",0),composerOpened:function(){this._lastPublish=new Date,(0,t.once)(this,"updateState")},composerStateChanged:function(){(0,t.once)(this,"updateState")},typing:function(){new Date-this._lastPublish>h&&this.publish({current:this.currentState})},composerClosing:function(){this.publish({previous:this.currentState}),(0,t.cancel)(this._pingTimer),(0,t.cancel)(this._clearTimer)},updateState:function(){var e=null,s=this.action;"reply"!==s&&"edit"!==s||(e={action:s},"reply"===s&&(e.topic_id=this.get("topic.id")),"edit"===s&&(e.post_id=this.get("post.id"))),this.set("previousState",this.currentState),this.set("currentState",e)},currentStateChanged:function(){var s=this;this.channel&&(this.messageBus.unsubscribe(this.channel),this.set("channel",null)),this.clear(),["reply","edit"].includes(this.action)&&this.publish({response_needed:!0,previous:this.previousState,current:this.currentState}).then(function(e){s.isDestroyed||(s.set("presenceUsers",e.users),s.set("channel",e.messagebus_channel),e.messagebus_channel&&s.messageBus.subscribe(e.messagebus_channel,function(e){s.isDestroyed||s.set("presenceUsers",e.users),s._clearTimer=(0,t.debounce)(s,"clear",h+f)},e.messagebus_id))})},clear:function(){this.isDestroyed||this.set("presenceUsers",[])},publish:function(e){return this._lastPublish=new Date,this.currentUser.hide_profile_and_presence?n.Promise.resolve():(0,i.ajax)("/presence/publish",{type:"POST",data:e})},users:function(e,s){return(e||[]).filter(function(e){return e.id!==s})}},"composerOpened",[o],Object.getOwnPropertyDescriptor(b,"composerOpened"),b),c(b,"composerStateChanged",[l],Object.getOwnPropertyDescriptor(b,"composerStateChanged"),b),c(b,"typing",[u],Object.getOwnPropertyDescriptor(b,"typing"),b),c(b,"composerClosing",[p],Object.getOwnPropertyDescriptor(b,"composerClosing"),b),c(b,"currentStateChanged",[d],Object.getOwnPropertyDescriptor(b,"currentStateChanged"),b),c(b,"users",[m],Object.getOwnPropertyDescriptor(b,"users"),b),b))}),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","@ember/runloop","@ember/component","@ember/object/computed","discourse-common/utils/decorators","discourse/plugins/discourse-presence/discourse/components/composer-presence-display"],function(e,t,s,r,n,i){"use strict";function a(t,r,e,s,n){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,s){return s(t,r,e)||e},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,r,i),i=null),i}var c,o,l,u,p;Object.defineProperty(e,"__esModule",{value:!0});e.default=s.default.extend((c=(0,n.on)("didInsertElement"),o=(0,n.on)("willDestroyElement"),l=(0,n.default)("topicId"),u=(0,n.default)("presenceUsers","currentUser.{id,ignored_users}"),a(p={topicId:null,presenceUsers:null,shouldDisplay:(0,r.gt)("users.length",0),clear:function(){this.isDestroyed||this.set("presenceUsers",[])},_inserted:function(){var s=this;this.clear(),this.messageBus.subscribe(this.channel,function(e){s.isDestroyed||s.set("presenceUsers",e.users),s._clearTimer=(0,t.debounce)(s,"clear",i.keepAliveDuration+i.bufferTime)},-2)},_destroyed:function(){(0,t.cancel)(this._clearTimer),this.messageBus.unsubscribe(this.channel)},channel:function(e){return"/presence/topic/"+e},users:function(e,s){var t=s.ignored_users||[];return(e||[]).filter(function(e){return e.id!==s.id&&!t.includes(e.username)})}},"_inserted",[c],Object.getOwnPropertyDescriptor(p,"_inserted"),p),a(p,"_destroyed",[o],Object.getOwnPropertyDescriptor(p,"_destroyed"),p),a(p,"channel",[l],Object.getOwnPropertyDescriptor(p,"channel"),p),a(p,"users",[u],Object.getOwnPropertyDescriptor(p,"users"),p),p))}),Ember.TEMPLATES["javascripts/components/topic-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["users"]]],null,{"statements":[[0,"        "],[1,[28,"avatar",[[23,1,[]]],[["avatarTemplatePath","usernamePath","imageSize"],["avatar_template","username","small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[1,[28,"i18n",["presence.replying_to_topic"],[["count"],[[24,["users","length"]]]]],false],[9],[7,"span",true],[10,"class","wave"],[8],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/topic-presence-display"}}),Ember.TEMPLATES["javascripts/components/composer-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["users"]]],null,{"statements":[[0,"        "],[1,[28,"avatar",[[23,1,[]]],[["avatarTemplatePath","usernamePath","imageSize"],["avatar_template","username","small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[0,"\\n"],[4,"if",[[24,["isReply"]]],null,{"statements":[[1,[28,"i18n",["presence.replying"],null],false]],"parameters":[]},{"statements":[[1,[28,"i18n",["presence.editing"],null],false]],"parameters":[]}],[9],[9],[7,"span",true],[10,"class","wave"],[8],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/composer-presence-display"}}),define("discourse/plugins/discourse-presence/discourse/templates/connectors/composer-fields/presence",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){return s.siteSettings.presence_enabled}}}),Ember.TEMPLATES["javascripts/connectors/composer-fields/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"composer-presence-display",null,[["action","post","topic","reply","title"],[[24,["model","action"]],[24,["model","post"]],[24,["model","topic"]],[24,["model","reply"]],[24,["model","title"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/composer-fields/presence"}}),define("discourse/plugins/discourse-presence/discourse/templates/connectors/topic-above-footer-buttons/presence",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){return s.siteSettings.presence_enabled}}}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"topic-presence-display",null,[["topicId"],[[24,["model","id"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/topic-above-footer-buttons/presence"}});
//# sourceMappingURL=https://sjc5.discourse-cdn.com/copa/assets/plugins/discourse-presence-15bdb63354777db2b2b32516be54d28a0c1cc13e0e3dfb06c5d279d81b59bd64.js.map