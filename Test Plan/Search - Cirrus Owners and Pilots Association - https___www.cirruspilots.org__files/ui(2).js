(function(n){typeof n.telligent=="undefined"&&(n.telligent={});typeof n.telligent.evolution=="undefined"&&(n.telligent.evolution={});typeof n.telligent.evolution.widgets=="undefined"&&(n.telligent.evolution.widgets={});var f=function(n){t(n);n.optionsPopup.glowPopUpPanel("show",n.optionsLink);n.optionsLink.addClass("active active__internal-link active__internal-link__search-options active__search-options")},i=function(n){t(n);n.optionsPopup.glowPopUpPanel("hide");n.optionsLink.removeClass("active active__internal-link active__internal-link__search-options active__search-options")},t=function(n){n.searchResultsPopup.glowPopUpPanel("hide")},e=function(n){n.searchResultsPopup.glowPopUpPanel("html",'<div class="pointer"><\/div><div class="content"><div class="message loading loading__message">'+n.loading+"<\/div><\/div>");n.searchResultsPopup.glowPopUpPanel("isShown")?n.searchResultsPopup.glowPopUpPanel("refresh"):n.searchResultsPopup.glowPopUpPanel("show",n.query)},r=function(t){n.telligent.evolution.get({url:t.searchUrl,data:{w_searchText:t.query.val(),w_groupId:t.groupId},success:function(n){t.searchResultsPopup.glowPopUpPanel("html",n);t.searchResultsPopup.glowPopUpPanel("isShown")?t.searchResultsPopup.glowPopUpPanel("refresh"):t.searchResultsPopup.glowPopUpPanel("show",t.query)},defaultErrorMessage:t.error,error:function(n,i){t.searchResultsPopup.glowPopUpPanel("html",'<div class="pointer"><\/div><div class="content"><div class="message error error__message">'+i+"<\/div><\/div>")}})},u=function(n){clearTimeout(n.changeTimeout);var i=n.query.val();i!==n.lastQuery&&(n.lastQuery=i,n.lastKeyCode=-1,clearTimeout(n.searchTimeout),n.lastQuery.length>0?(n.query.removeClass("empty"),e(n),n.searchTimeout=setTimeout(function(){r(n)},499)):(n.query.addClass("empty"),t(n)));n.changeTimeout=setTimeout(function(){u(n)},99)};n.telligent.evolution.widgets.siteSearch={register:function(e){e.searchResultsPopup=n("<div><\/div>").glowPopUpPanel({cssClass:"menu search-content results menu__results menu__search-content menu__results__search-content results__search-content",position:"downright",zIndex:1e3,hideOnDocumentClick:!0});e.optionsLink.length>0&&e.optionsContent.length>0&&(e.optionsPopup=e.optionsContent.show().glowPopUpPanel({cssClass:"menu search-content options menu__options menu_search-content menu__options__search-content options__search-content",position:"downleft",zIndex:1e3,hideOnDocumentClick:!1}).bind("glowPopUpPanelMouseOver",function(){e.mouseInOptionsPopup=!0}).bind("glowPopUpPanelMouseOut",function(){e.mouseInOptionsPopup=!1}),e.optionsLink.click(function(){return e.optionsPopup.glowPopUpPanel("isShown")?i(e):f(e),!1}),e.optionsPopup.glowPopUpPanel("children").find('input[name="'+e.filterName+'"]').click(function(){i(e);n(this).is(":checked")&&(e.groupId=n(this).val());e.query.focus()}).filter(':[value="'+e.groupId+'"]').attr("checked",!0));e.query.attr("autocomplete","off").keydown(function(i){var f,o,r,u,s;return i.keyCode===13?(clearTimeout(e.searchTimeout),f=e.searchResultsPopup.glowPopUpPanel("children").find("a.selected"),f.length>0?window.location=f.first().attr("href"):(o={q:e.query.val()},e.groupId>0&&(o.group=e.groupId),window.location=e.searchResultsUrl.replace(/\{0\}/gi,n.param(o)).replace(/\+/gi,"%20").replace(/'/gi,"%27")),t(e),e.query.blur(),!1):i.keyCode===38?(r=null,e.searchResultsPopup.glowPopUpPanel("children").find("a").each(function(){if(n(this).hasClass("selected"))return n(this).removeClass("selected"),r&&n(r).addClass("selected"),!1;r=this}),!1):i.keyCode===40?(u=!1,s=!1,e.searchResultsPopup.glowPopUpPanel("children").find("a").each(function(){if(n(this).hasClass("selected"))u=!0,n(this).removeClass("selected");else if(u)return n(this).addClass("selected"),s=!0,!1}),s||(u?e.searchResultsPopup.glowPopUpPanel("children").find("a").last().addClass("selected"):e.searchResultsPopup.glowPopUpPanel("children").find("a").first().addClass("selected")),!1):void 0}).focus(function(){n(this).hasClass("empty")||(e.lastKeyCode=-1,clearTimeout(e.searchTimeout),r(e));clearTimeout(e.changeTimeout);e.changeTimeout=setTimeout(function(){u(e)},99)}).blur(function(){clearTimeout(e.searchTimeout);clearTimeout(e.changeTimeout)});n(document).click(function(){e.optionsPopup&&e.optionsPopup.glowPopUpPanel("isShown")&&!e.mouseInOptionsPopup&&i(e)})}}})(jQuery);