define("discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes",["exports","discourse/lib/show-modal","discourse/lib/load-script"],function(e,r,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.showUserNotes=function(e,t,o,n){return n=n||{},(0,s.default)("defer/html-sanitizer-bundle").then(function(){return e.find("user-note",{user_id:t}).then(function(e){var s=(0,r.default)("user-notes",{model:e,title:"user_notes.title",addModalBodyView:!0});return s.reset(),s.setProperties({userId:t,callback:o,postId:n.postId}),s})})}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/admin-user-controls-after/add-user-notes-button",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-profile-controls/show-notes-on-profile"],function(e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=s.default}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-profile-controls/show-notes-on-profile",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner"],function(e,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){var t=s.siteSettings,o=s.currentUser;return t.user_notes_enabled&&o&&o.staff},setupComponent:function(e,s){var t=e.model;s.set("userNotesCount",t.user_notes_count||t.get("custom_fields.user_notes_count")||0)},actions:{showUserNotes:function(){var s=this,e=(0,n.getOwner)(this).lookup("store:main"),t=this.get("args.model");(0,o.showUserNotes)(e,t.id,function(e){return s.set("userNotesCount",e)})}}}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/flagged-post-controls/show-user-notes-on-flags",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner"],function(e,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){return s.siteSettings.user_notes_enabled},setupComponent:function(e,s){var t=e.flaggedPost.user;s.set("userNotesCount",t.get("custom_fields.user_notes_count")||0)},actions:{showUserNotes:function(){var s=this,e=(0,n.getOwner)(this).lookup("store:main"),t=this.get("args.flaggedPost.user");(0,o.showUserNotes)(e,t.id,function(e){return s.set("userNotesCount",e)})}}}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-card-post-names/show-user-notes-on-card",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner","discourse/lib/text"],function(e,o,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){var t=s.siteSettings,o=s.currentUser;return t.user_notes_enabled&&o&&o.staff},setupComponent:function(e,s){var t=e.user,o=t.user_notes_count||t.get("custom_fields.user_notes_count")||0;s.setProperties({userNotesCount:o,emojiEnabled:s.siteSettings.enable_emoji,emojiUrl:(0,r.emojiUrlFor)("pencil"),user:t,userNotesTitle:I18n.t("user_notes.show",{count:o})})},actions:{showUserNotes:function(){var s=this;this.parentView.parentView._close();var e=(0,n.getOwner)(this).lookup("store:main"),t=this.get("args.user");(0,o.showUserNotes)(e,t.id,function(e){s.isDestroying||s.isDestroyed||s.set("userNotesCount",e)})}}}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/admin-user-controls-after/add-user-notes-button"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"show-user-notes",null,[["show","count"],[[28,"action",[[23,0,[]],"showUserNotes"],null],[24,["userNotesCount"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/admin-user-controls-after/add-user-notes-button"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/user-profile-controls/show-notes-on-profile"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"li",true],[8],[0,"\\n  "],[1,[28,"show-user-notes",null,[["show","count"],[[28,"action",[[23,0,[]],"showUserNotes"],null],[24,["userNotesCount"]]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/user-profile-controls/show-notes-on-profile"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/flagged-post-controls/show-user-notes-on-flags"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["userNotesCount"]]],null,{"statements":[[0,"  "],[1,[28,"show-user-notes",null,[["show","count"],[[28,"action",[[23,0,[]],"showUserNotes"],null],[24,["userNotesCount"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/flagged-post-controls/show-user-notes-on-flags"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/user-card-post-names/show-user-notes-on-card"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["userNotesCount"]]],null,{"statements":[[0,"  "],[7,"a",false],[12,"href",""],[12,"title",[29,[[22,"userNotesTitle"]]]],[3,"action",[[23,0,[]],"showUserNotes"]],[8],[0,"\\n"],[4,"if",[[24,["emojiEnabled"]]],null,{"statements":[[0,"      "],[7,"img",true],[11,"src",[22,"emojiUrl"]],[11,"title",[22,"userNotesTitle"]],[10,"alt","pencil"],[10,"class","emoji"],[8],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[1,[28,"d-icon",["sticky-note"],null],false],[0,"\\n"]],"parameters":[]}],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/user-card-post-names/show-user-notes-on-card"}}),define("discourse/plugins/discourse-user-notes/discourse/adapters/user-note",["exports","discourse/adapters/rest","discourse/lib/ajax"],function(e,s,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=s.default.extend({destroyRecord:function(e,s,t){var o=this.pathFor(e,s,t.id);return(0,n.ajax)(o+"?user_id="+t.user_id,{method:"DELETE"})}})}),define("discourse/plugins/discourse-user-notes/discourse/components/show-user-notes",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend({tagName:"",showCount:Ember.computed.gt("count",0)})}),define("discourse/plugins/discourse-user-notes/discourse/controllers/user-notes",["exports","ember-addons/ember-computed-decorators","discourse/lib/ajax-error"],function(e,s,n){"use strict";function t(t,o,e,s,n){var r={};return Object.keys(s).forEach(function(e){r[e]=s[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=e.slice().reverse().reduce(function(e,s){return s(t,o,e)||e},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(t,o,r),r=null),r}var o,r,u;Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Controller.extend((o=(0,s.on)("init"),r=(0,s.default)("newNote","saving"),t(u={newNote:null,saving:!1,user:null,reset:function(){this.setProperties({newNote:null,saving:!1,callback:null})},attachDisabled:function(e,s){return s||!e||0===e.length},_refreshCount:function(){this.callback&&this.callback(this.get("model.length"))},actions:{attachNote:function(){var e=this,s=this.store.createRecord("user-note"),t=parseInt(this.userId,10);this.set("saving",!0);var o={raw:this.newNote,user_id:t};this.postId&&(o.post_id=parseInt(this.postId,10)),s.save(o).then(function(){e.set("newNote",""),e.model.insertAt(0,s),e._refreshCount()}).catch(n.popupAjaxError).finally(function(){return e.set("saving",!1)})},removeNote:function(s){var t=this;bootbox.confirm(I18n.t("user_notes.delete_confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(e){e&&s.destroyRecord().then(function(){t.model.removeObject(s),t._refreshCount()}).catch(n.popupAjaxError)})}}},"reset",[o],Object.getOwnPropertyDescriptor(u,"reset"),u),t(u,"attachDisabled",[r],Object.getOwnPropertyDescriptor(u,"attachDisabled"),u),u))}),Ember.TEMPLATES["javascripts/components/show-user-notes"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"a",false],[12,"href",""],[12,"class","btn"],[3,"action",[[23,0,[]],[24,["show"]]]],[8],[0,"\\n  "],[1,[28,"d-icon",["pencil-alt"],null],false],[0,"\\n"],[4,"if",[[24,["showCount"]]],null,{"statements":[[0,"    "],[1,[28,"i18n",["user_notes.show"],[["count"],[[24,["count"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[1,[28,"i18n",["user_notes.title"],null],false],[0,"\\n"]],"parameters":[]}],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/components/show-user-notes"}}),Ember.TEMPLATES["javascripts/modal/user-notes"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["n"],"statements":[[4,"d-modal-body",null,[["class"],["user-notes-modal"]],{"statements":[[0,"  "],[1,[28,"textarea",null,[["value"],[[24,["newNote"]]]]],false],[0,"\\n  "],[1,[28,"d-button",null,[["action","label","class","disabled"],[[28,"action",[[23,0,[]],"attachNote"],null],"user_notes.attach","btn-primary",[24,["attachDisabled"]]]]],false],[0,"\\n\\n"],[4,"each",[[24,["model"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","user-note"],[8],[0,"\\n      "],[7,"div",true],[10,"class","posted-by"],[8],[0,"\\n"],[4,"user-link",null,[["user"],[[23,1,["created_by"]]]],{"statements":[[0,"          "],[1,[28,"avatar",[[23,1,["created_by"]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"      "],[9],[0,"\\n      "],[7,"div",true],[10,"class","note-contents"],[8],[0,"\\n        "],[7,"div",true],[10,"class","note-info"],[8],[0,"\\n          "],[7,"span",true],[10,"class","username"],[8],[1,[23,1,["created_by","username"]],false],[9],[0,"\\n          "],[7,"span",true],[10,"class","post-date"],[8],[1,[28,"age-with-tooltip",[[23,1,["created_at"]]],null],false],[9],[0,"\\n\\n"],[4,"if",[[23,1,["can_delete"]]],null,{"statements":[[0,"            "],[7,"span",true],[10,"class","controls"],[8],[0,"\\n              "],[1,[28,"d-button",null,[["action","icon","class","title"],[[28,"action",[[23,0,[]],"removeNote",[23,1,[]]],null],"far-trash-alt","btn-small btn-danger","user_notes.remove"]]],false],[0,"\\n            "],[9],[0,"\\n"]],"parameters":[]},null],[0,"        "],[9],[0,"\\n\\n        "],[7,"div",true],[10,"class","cooked"],[8],[0,"\\n          "],[1,[28,"cook-text",[[23,1,["raw"]]],null],false],[0,"\\n        "],[9],[0,"\\n\\n"],[4,"if",[[23,1,["post_id"]]],null,{"statements":[[0,"          "],[1,[28,"d-button",null,[["class","href","action","title","translatedLabel"],["btn btn-small",[23,1,["post_url"]],[28,"route-action",["closeModal"],null],"user_notes.show_post",[28,"i18n",["user_notes.show_post"],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"      "],[9],[0,"\\n\\n      "],[7,"div",true],[10,"class","clearfix"],[8],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[1]},null]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/modal/user-notes"}}),Ember.TEMPLATES["javascripts/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["siteSettings","user_notes_enabled"]]],null,{"statements":[[0,"  "],[1,[28,"admin-report",null,[["dataSourceName","startDate","endDate"],["user_notes",[24,["lastWeek"]],[24,["endDate"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table"}}),define("discourse/plugins/discourse-user-notes/discourse/initializers/enable-user-notes",["exports","discourse/lib/plugin-api","discourse-common/lib/icon-library","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes"],function(e,t,r,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"enable-user-notes",initialize:function(e){var o=e.lookup("site-settings:main"),s=e.lookup("current-user:main");if(o.user_notes_enabled&&s&&s.staff){var n=e.lookup("store:main");(0,t.withPluginApi)("0.8.15",function(e){function s(){var s=this;(0,u.showUserNotes)(n,this.attrs.user_id,function(e){s.sendWidgetAction("refreshUserNotes",e)},{postId:this.attrs.id})}e.attachWidgetAction("post","refreshUserNotes",function(e){var s=this.model.user_custom_fields||{};s.user_notes_count=e,this.model.set("user_custom_fields",s)}),e.modifyClass("controller:user",{userNotesCount:null,_modelChanged:function(){this.set("userNotesCount",this.get("model.custom_fields.user_notes_count")||0)}.observes("model").on("init"),actions:{showUserNotes:function(){var s=this;(0,u.showUserNotes)(n,this.model.id,function(e){return s.set("userNotesCount",e)})}}});var t=e.container.lookup("site:main").mobileView?"before":"after";e.decorateWidget("poster-name:"+t,function(e){if(!e.widget.settings.hideNotes)return 0<(e.attrs.userCustomFields||{}).user_notes_count?e.attach("user-notes-icon"):void 0}),e.decorateWidget("post-avatar:after",function(e){if(e.widget.settings.showNotes)return 0<(e.attrs.userCustomFields||{}).user_notes_count?e.attach("user-notes-icon"):void 0}),e.decorateWidget("post-admin-menu:after",function(e){return e.attach("post-admin-menu-button",{icon:"pencil-alt",label:"user_notes.attach",action:"showUserNotes"})}),e.attachWidgetAction("post","showUserNotes",s),e.createWidget("user-notes-icon",{tagName:"span.user-notes-icon",click:s,html:function(){return o.enable_emoji?this.attach("emoji",{name:"pencil"}):(0,r.iconNode)("sticky-note")}})})}}}});
//# sourceMappingURL=https://sjc5.discourse-cdn.com/copa/assets/plugins/discourse-user-notes-91e31f14c8666f5970f18ed6bcb76ee13a9515eec785de7c04f9820a0c3ced0d.js.map